@page "/admin/dashboard"
@rendermode InteractiveServer
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Roles = "Admin")]
@using GrapheneTrace.Web.Models
@using GrapheneTrace.Web.Components.Layout

<div class="admin-container">
    <AdminHeader />

    <div class="admin-content">
        <div class="welcome-card">
            <p class="welcome-message">
                <strong>Welcome, @userName!</strong>
            </p>
            <p class="role-info">
                Role: <strong>Administrator</strong>
            </p>
            <p class="access-info">
                You have access to all system features and settings.
            </p>
        </div>

        <h2 class="section-title">Overview</h2>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <h3>Total Users</h3>
                    <div class="stat-dot stat-dot-black"></div>
                </div>
                <div class="stat-value">@stats.TotalUsers</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <h3>Clinicians</h3>
                    <div class="stat-dot stat-dot-green"></div>
                </div>
                <div class="stat-value">@stats.Clinicians</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <h3>Patients</h3>
                    <div class="stat-dot stat-dot-blue"></div>
                </div>
                <div class="stat-value">@stats.Patients</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <h3>Pending Requests</h3>
                    <div class="stat-dot stat-dot-orange"></div>
                </div>
                <div class="stat-value">@stats.PendingRequests</div> 
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-card modern-chart">
                <div class="chart-header">
                    <div>
                        <h3 class="chart-title">User Growth</h3>
                        <p class="chart-subtitle">Last @chartDays days</p>
                    </div>
                    <select class="chart-dropdown" @onchange="OnTimeRangeChanged">
                        <option value="30">30 days</option>
                        <option value="60">60 days</option>
                        <option value="90">90 days</option>
                    </select>
                </div>
                <div class="chart-container">
                    @if (chartData != null && chartData.Any())
                    {
                        <svg viewBox="0 0 1000 400" class="modern-line-chart" preserveAspectRatio="xMidYMid meet">
                            <defs>
                                <linearGradient id="modernGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.25" />
                                    <stop offset="50%" style="stop-color:#3b82f6;stop-opacity:0.08" />
                                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0" />
                                </linearGradient>
                                <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
                                </linearGradient>
                            </defs>

                            <rect width="1000" height="400" fill="#f8fafc" />

                            <g stroke="#e2e8f0" stroke-width="0.5" opacity="0.6">
                                @for (int i = 0; i <= 5; i++)
                                {
                                    <line x1="80" y1="@(60 + i * 56)" x2="950" y2="@(60 + i * 56)" />
                                }
                            </g>

                            <text x="35" y="45" font-size="12" fill="#64748b" font-weight="500" text-anchor="end">Users</text>

                            <line x1="80" y1="40" x2="80" y2="340" stroke="#cbd5e1" stroke-width="1.5" />
                            <line x1="80" y1="340" x2="950" y2="340" stroke="#cbd5e1" stroke-width="1.5" />

                            @((MarkupString)GetChartAxisLabels())

                            <polygon points="@GetChartPolygonPointsModern()" fill="url(#modernGradient)" />

                            <polyline points="@GetChartPolylinePointsModern()" fill="none" stroke="url(#lineGradient)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />

                            @for (int i = 0; i < chartData.Count; i++)
                            {
                                var (x, y) = GetChartPointCoordinatesModern(i);
                                <circle cx="@x" cy="@y" r="2.5" fill="#3b82f6" stroke="white" stroke-width="2" class="modern-data-point" opacity="0.8"
                                    @onmouseover="() => ShowTooltip(i)"
                                    @onmouseout="HideTooltip"
                                    style="cursor: pointer;" />
                            }
                        </svg>

                        @if (showTooltip)
                        {
                            <div class="modern-tooltip" style="left: @(tooltipPixelX)px; top: @(tooltipPixelY)px;">
                                <div class="tooltip-date">@tooltipDate</div>
                                <div class="tooltip-value">@tooltipCount <span class="tooltip-label">new users</span></div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="chart-empty-state">
                            <p>No signup data available for the selected period.</p>
                        </div>
                    }
                </div>
            </div>

            <div class="activity-card">
                <h3>Recent Activity</h3>
                <div class="activity-list">
                    @if (recentActivities != null && recentActivities.Any())
                    {
                        @foreach (var activity in recentActivities)
                        {
                            <div class="activity-item">
                                <div class="activity-text">
                                    <p class="activity-main">@activity.UserName created an account</p>
                                    <p class="activity-time">@activity.GetRelativeTime()</p>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="activity-item">
                            <div class="activity-text">
                                <p class="activity-main">No recent activity</p>
                                <p class="activity-time">-</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="alerts-section">
            <h3>System Alerts</h3>
            <div class="alerts-list">
                <div class="alert-item coming-soon">
                    <div class="alert-text">
                        <p>Coming soon</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="admin-footer">
        <p>Contact us · About · FAQ</p>
    </div>
</div>
