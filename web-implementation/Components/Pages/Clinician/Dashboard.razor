@page "/clinician/dashboard"
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Roles = "Clinician")]
@rendermode InteractiveServer
@using GrapheneTrace.Web.Models
@using GrapheneTrace.Web.Components.Layout

<div class="admin-container">
    <ClinicianHeader />

    <div class="clinician-content">
        @if (isLoading)
        {
            <div class="loading">Loading patient data...</div>
        }
        else
        {
            <!-- Approved Patients Section -->
            <div class="section">
                <h2 class="section-title">
                    <span class="status-badge approved">✓</span> Active Patients
                </h2>
                @if (approvedPatients.Any())
                {
                    <div class="patient-grid">
                        <div class="grid-header">
                            <div>Name</div>
                            <div>Email</div>
                            <div>Assigned Since</div>
                            <div>Action</div>
                        </div>
                        @foreach (var patient in approvedPatients)
                        {
                            <div class="grid-row">
                                <div>
                                    <strong>@patient.Patient?.FirstName @patient.Patient?.LastName</strong>
                                </div>
                                <div>@patient.Patient?.Email</div>
                                <div>
                                    @if (patient.AssignedAt != default)
                                    {
                                        <span>@patient.AssignedAt.ToString("MMM dd, yyyy")</span>
                                    }
                                </div>
                                <div>
                                    <button class="check-btn" @onclick="() => ShowCheckPopup(patient.Patient?.Id ?? Guid.Empty)">View Details</button>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-state">No active patients yet.</div>
                }
            </div>

            <!-- Pending Requests Section -->
            <div class="section">
                <h2 class="section-title">
                    <span class="status-badge pending">⏳</span> Pending Requests
                </h2>
                @if (pendingRequests.Any())
                {
                    <div class="patient-grid">
                        <div class="grid-header">
                            <div>Name</div>
                            <div>Email</div>
                            <div>Requested</div>
                            <div>Action</div>
                        </div>
                        @foreach (var request in pendingRequests)
                        {
                            <div class="grid-row">
                                <div>
                                    <strong>@request.Patient?.FirstName @request.Patient?.LastName</strong>
                                </div>
                                <div>@request.Patient?.Email</div>
                                <div>
                                    @if (request.RequestedAt != default)
                                    {
                                        <span>@request.RequestedAt.ToString("MMM dd, yyyy")</span>
                                    }
                                </div>
                                <div class="action-buttons">
                                    <button class="approve-btn" @onclick="() => ApproveRequest(request.Id)">Approve</button>
                                    <button class="reject-btn" @onclick="() => RejectRequest(request.Id)">Reject</button>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-state">No pending requests.</div>
                }
            </div>
        }
    </div>
</div>
