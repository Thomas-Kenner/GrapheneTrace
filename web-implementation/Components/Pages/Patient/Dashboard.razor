@page "/patient/dashboard"
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Roles = "Patient")]
@using GrapheneTrace.Web.Models
@using GrapheneTrace.Web.Components.Layout
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthStateProvider

@*
    Patient Dashboard Page
    Author: SID:2412494
    Route: /patient/dashboard

    Purpose: Main dashboard for patient users.

    Authorization: Restricted to Patient role only using [Authorize(Roles = "Patient")].
    Users without the Patient role will receive a 403 Forbidden and be redirected to /access-denied.

    Current Implementation: Dashboard with tab navigation similar to admin interface.
    Production TODO: Add patient-specific features (personal pressure data, alerts, settings, etc.)
*@

<div class="admin-container">
    @*
        PATIENT HEADER
        Author: SID:2412494

        Purpose:
        Unified header component for all patient pages with tab navigation.
        Provides easy access to different patient sections.
    *@
    <PatientHeader />

    <!-- Main Content -->
    <div class="admin-content">
        @*
            WELCOME SECTION
            Author: SID:2412494

            Purpose:
            Personalizes the dashboard by displaying the logged-in patient's name
            and providing quick context about their role.
        *@
        <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 2rem;">
            <p style="margin-bottom: 0.5rem;">
                <strong>Welcome, @userName!</strong>
            </p>
            <p style="color: #6b7280; margin-bottom: 0.5rem;">
                Role: <strong>Patient</strong>
            </p>
            <p style="color: #6b7280;">
                View your pressure data and manage your settings.
            </p>
        </div>

        @*
            QUICK ACTIONS SECTION
            Author: SID:2412494

            Purpose:
            Provides common actions and navigation to frequently-used patient features.
        *@
        <h2 class="section-title">Quick Actions</h2>

        <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem;">
            <p style="color: #6b7280; margin-bottom: 1rem;">
                Patient features coming soon: Pressure data visualization, alert history, personal information, etc.
            </p>
        </div>
    </div>

    @*
        FOOTER SECTION
        Author: SID:2412494

        Purpose:
        Provides global navigation links for help, information, and support resources.
    *@
    <div class="admin-footer">
        <p>Contact us · About · FAQ</p>
    </div>
</div>

@code {
    private string userName = "";

    /// <summary>
    /// Component initialization: loads user information from authentication state.
    /// Author: SID:2412494
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        userName = authState.User.Identity?.Name ?? "Unknown";

        // Role verification is handled by [Authorize(Roles = "Patient")] attribute
        // Non-patient users are automatically redirected to /access-denied
    }
}
