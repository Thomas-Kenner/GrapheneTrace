@namespace GrapheneTrace.Web.Components.UI

@*
    Form Input Component with Label
    Author: SID:2412494

    Purpose: Provides labeled form inputs with two-way data binding for authentication forms.
    Design Pattern: Controlled component pattern with @bind-Value support.

    Why separate component: Ensures consistent label/input pairing and styling,
    reduces markup duplication across forms.
*@

@* Author: SID:2412494 - Added visual required indicator (asterisk), hint text, and show/hide password toggle *@
<div class="form-group">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="form-label" for="@Id">
            @Label
            @if (Required)
            {
                <span style="color: #ef4444; margin-left: 0.25rem;">*</span>
            }
        </label>
    }
    @if (InputType == "password")
    {
        @* Author: SID:2412494 - Password input with show/hide toggle button using pure JS for static form compatibility *@
        <div style="position: relative;">
            <input
                class="form-input"
                type="password"
                id="@Id"
                name="@Name"
                placeholder="@Placeholder"
                value="@Value"
                required="@Required"
                style="padding-right: 2.5rem;"
                @oninput="HandleInput" />
            <button type="button"
                    onclick="(function(btn) {
                        var input = btn.previousElementSibling;
                        var eyeOpen = btn.querySelector('.eye-open');
                        var eyeClosed = btn.querySelector('.eye-closed');
                        if (input.type === 'password') {
                            input.type = 'text';
                            eyeOpen.style.display = 'none';
                            eyeClosed.style.display = 'block';
                            btn.title = 'Hide password';
                        } else {
                            input.type = 'password';
                            eyeOpen.style.display = 'block';
                            eyeClosed.style.display = 'none';
                            btn.title = 'Show password';
                        }
                    })(this)"
                    style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0.25rem; color: #6b7280;"
                    title="Show password"
                    tabindex="-1">
                @* Eye icon (password hidden) - shown by default *@
                <svg class="eye-open" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                @* Eye-off icon (password visible) - hidden by default *@
                <svg class="eye-closed" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
            </button>
        </div>
    }
    else
    {
        <input
            class="form-input"
            type="@InputType"
            id="@Id"
            name="@Name"
            placeholder="@Placeholder"
            value="@Value"
            required="@Required"
            @oninput="HandleInput" />
    }
    @if (!string.IsNullOrEmpty(HintText))
    {
        <p style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem; margin-bottom: 0;">@HintText</p>
    }
</div>

@code {
    /// <summary>
    /// Optional label text displayed above the input.
    /// </summary>
    [Parameter]
    public string? Label { get; set; }

    /// <summary>
    /// HTML id attribute for the input (auto-generated if not provided).
    /// </summary>
    /// <remarks>
    /// Design Decision: Auto-generate unique ID using Guid.
    /// Why: Ensures label 'for' attribute correctly associates with input for accessibility,
    /// even when multiple instances exist on the same page.
    /// </remarks>
    [Parameter]
    public string Id { get; set; } = Guid.NewGuid().ToString();

    /// <summary>
    /// HTML input type (text, email, password, etc.).
    /// </summary>
    [Parameter]
    public string InputType { get; set; } = "text";

    /// <summary>
    /// HTML name attribute for form submission.
    /// </summary>
    [Parameter]
    public string? Name { get; set; }

    /// <summary>
    /// Whether the input is required.
    /// </summary>
    [Parameter]
    public bool Required { get; set; }

    /// <summary>
    /// Placeholder text shown when input is empty.
    /// </summary>
    [Parameter]
    public string? Placeholder { get; set; }

    /// <summary>
    /// Optional hint text displayed below the input (e.g., password requirements).
    /// Author: SID:2412494
    /// </summary>
    [Parameter]
    public string? HintText { get; set; }

    /// <summary>
    /// Current input value (supports @bind-Value two-way binding).
    /// </summary>
    [Parameter]
    public string? Value { get; set; }

    /// <summary>
    /// Event callback for value changes (required for @bind-Value pattern).
    /// </summary>
    /// <remarks>
    /// Blazor Convention: Parameter named "Value" + EventCallback named "ValueChanged"
    /// enables @bind-Value="variable" syntax in parent components.
    /// </remarks>
    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    /// <summary>
    /// Handles input events and propagates value changes to parent.
    /// </summary>
    /// <remarks>
    /// Design Decision: Use @oninput instead of @onchange for real-time updates.
    /// Why: @oninput fires on every keystroke, enabling immediate validation.
    /// @onchange only fires when input loses focus, creating poor UX.
    /// </remarks>
    private async Task HandleInput(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }
}
